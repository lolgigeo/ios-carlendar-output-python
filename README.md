# macOS 日历导出工具

这是一个用于一键导出 macOS 系统日历中所有日程记录的 Python 脚本。该工具可以将日历事件导出为 CSV 格式，支持按照时间范围筛选和指定特定日历导出。

## 功能特点

- 导出 macOS 系统日历中的所有日程记录
- 支持按照开始日期和结束日期筛选导出
- 支持指定特定日历导出
- 导出的信息包括：日历名称、日程名称、开始时间、结束时间、日程描述、地点
- 生成的 CSV 文件使用 UTF-8 编码，可在 Excel 等软件中正常显示中文

## 使用方法

### 前提条件

- 运行在 macOS 系统上
- 已安装 Python 3
- 拥有访问系统日历的权限

### 基本使用

最简单的方法是直接双击运行 **"一键导出日历.command"** 文件，然后按照提示进行操作。

### 导出选项

运行脚本后，您可以选择以下导出选项：

1. **导出所有日历的所有日程** - 导出系统中所有日历的所有日程事件
2. **导出指定时间范围内的日程** - 按照您指定的开始日期和结束日期导出日程
3. **导出指定日历的所有日程** - 只导出您指定的某个日历中的所有日程
4. **导出指定日历和时间范围内的日程** - 组合日历和时间范围进行筛选导出
5. **导出当年度日历** - 自动导出今年（1月1日至12月31日）的所有日程或指定日历
6. **导出去年度日历** - 自动导出去年（1月1日至12月31日）的所有日程或指定日历
7. **导出最近一个月日历** - 自动导出从一个月前到今天的所有日程或指定日历

### 命令行高级使用

如果您需要在脚本或终端中直接使用，可以通过命令行运行核心脚本：

```bash
# 导出所有日历的所有日程
python3 calendar_export.py

# 导出指定时间范围内的日程
python3 calendar_export.py --start 2023-01-01 --end 2023-12-31

# 导出指定日历的所有日程
python3 calendar_export.py --calendar "工作"

# 自定义输出文件名
python3 calendar_export.py --output "我的日程.csv"

# 组合使用参数
python3 calendar_export.py --calendar "个人" --start 2023-01-01 --end 2023-12-31 --output "2023年个人日程.csv"

# 导出当前年度所有日历
python3 calendar_export.py --start $(date +%Y)-01-01 --end $(date +%Y)-12-31

# 导出去年所有日历
python3 calendar_export.py --start $(date -v-1y +%Y)-01-01 --end $(date -v-1y +%Y)-12-31

# 导出最近一个月日历
python3 calendar_export.py --start $(date -v-1m +%Y-%m-%d) --end $(date +%Y-%m-%d)
```

## 参数说明

| 参数 | 说明 | 格式 | 是否必需 |
|------|------|------|----------|
| --calendar | 指定要导出的日历名称 | 字符串，如 "工作" | 否 |
| --start | 开始日期 | YYYY-MM-DD，如 "2023-01-01" | 否 |
| --end | 结束日期 | YYYY-MM-DD，如 "2023-12-31" | 否 |
| --output | 输出的 CSV 文件名 | 字符串，如 "日程导出.csv" | 否 |

## 常见问题

### 1. 运行脚本时提示没有权限访问日历

首次运行脚本时，macOS 会弹出提示框询问是否允许终端访问您的日历。请点击"允许"以授权访问。如果您不小心点击了"不允许"，可以在系统偏好设置 > 安全性与隐私 > 隐私 > 日历中，勾选终端的权限。

### 2. 导出的 CSV 文件在 Excel 中显示乱码

脚本生成的 CSV 文件使用 UTF-8 编码。在 Excel 中打开时，请选择正确的编码方式。或者您可以使用 Numbers 应用程序打开，它能更好地支持 UTF-8 编码的 CSV 文件。

### 3. 导出的事件信息不完整

某些日历事件可能没有描述或地点信息，这是正常现象，取决于事件创建时是否填写了这些信息。

## 注意事项

- 此脚本仅适用于 macOS 系统，无法在 Windows 或 Linux 系统上运行
- 导出大量日程事件时可能需要一些时间，请耐心等待
- 建议定期备份您的日历数据，以防数据丢失

## 如何修改脚本

如果您需要自定义导出的字段或功能，可以直接编辑 `calendar_export.py` 文件。脚本中的主要函数包括：

- `run_applescript()`: 执行 AppleScript 脚本
- `get_all_calendars()`: 获取所有日历名称
- `export_calendar_events()`: 导出日历事件
- `save_to_csv()`: 将事件保存为 CSV 文件
- `main()`: 主函数，处理命令行参数并调用其他函数

## 更新日志

- v1.0: 初始版本，支持导出所有日历事件到 CSV 文件
